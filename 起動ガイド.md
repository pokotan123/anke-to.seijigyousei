# システム起動ガイド

## 前提条件の確認

以下のツールがインストールされている必要があります：

- Node.js 18以上
- PostgreSQL 14以上（またはDocker）
- Redis 6以上（またはDocker）
- npm または yarn

## 起動手順

### 1. データベースとRedisの起動

#### オプションA: Docker Composeを使用（推奨）

```bash
# プロジェクトルートで実行
docker compose up -d

# 起動確認
docker compose ps
```

#### オプションB: 手動で起動

1. PostgreSQLを起動し、データベースを作成：
```sql
CREATE DATABASE survey_db;
CREATE USER survey_user WITH PASSWORD 'survey_password';
GRANT ALL PRIVILEGES ON DATABASE survey_db TO survey_user;
```

2. `database/init.sql`を実行してテーブルを作成

3. Redisを起動

### 2. バックエンドのセットアップ

```bash
cd backend

# 依存関係のインストール
npm install

# 環境変数の確認
# .envファイルが存在することを確認（存在しない場合は.env.exampleをコピー）

# データベースのシード（サンプルデータ投入）
npm run seed

# 開発サーバー起動
npm run dev
```

バックエンドは `http://localhost:3001` で起動します。

### 3. フロントエンドのセットアップ

新しいターミナルで：

```bash
cd frontend

# 依存関係のインストール
npm install

# 環境変数の確認
# .env.localファイルが存在することを確認

# 開発サーバー起動
npm run dev
```

フロントエンドは `http://localhost:3000` で起動します。

## 動作確認

### 1. バックエンドの確認

```bash
# ヘルスチェック
curl http://localhost:3001/health

# 期待されるレスポンス:
# {"status":"ok","timestamp":"2024-..."}
```

### 2. フロントエンドの確認

ブラウザで以下にアクセス：
- トップページ: http://localhost:3000
- 管理画面ログイン: http://localhost:3000/admin/login

### 3. ログイン

- **ユーザー名**: `admin`
- **パスワード**: `admin123`

### 4. サンプルアンケートの確認

シードデータ実行後、以下のようなログが表示されます：
```
📋 Survey URL: http://localhost:3000/vote/{unique_token}
```

このURLにアクセスして投票画面を確認できます。

## トラブルシューティング

### データベース接続エラー

```
❌ Database connection error: ...
```

**解決方法**:
- PostgreSQLが起動しているか確認
- `DATABASE_URL`が正しく設定されているか確認
- データベースとユーザーが作成されているか確認

### Redis接続エラー

```
❌ Redis connection error: ...
```

**解決方法**:
- Redisが起動しているか確認
- `REDIS_URL`が正しく設定されているか確認

### ポートが既に使用されている

```
Error: listen EADDRINUSE: address already in use :::3001
```

**解決方法**:
- 既に起動しているプロセスを停止
- または、`.env`ファイルでポート番号を変更

### モジュールが見つからない

```
Error: Cannot find module '...'
```

**解決方法**:
```bash
# バックエンド
cd backend
npm install

# フロントエンド
cd frontend
npm install
```

## 次のステップ

1. 管理画面にログイン
2. アンケートを作成
3. 質問・選択肢を追加
4. 投票URLをコピーして投票画面を確認
5. 分析ダッシュボードで結果を確認

---

**注意**: 本番環境では必ず以下を変更してください：
- 管理者パスワード
- JWT_SECRET
- SESSION_SECRET
- データベースパスワード

