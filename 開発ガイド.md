# 開発ガイド

## セットアップ手順

### 1. 環境構築

#### Docker Composeを使用する場合（推奨）

```bash
# Docker ComposeでPostgreSQLとRedisを起動
docker-compose up -d

# データベースの初期化（自動実行されます）
```

#### 手動でセットアップする場合

1. PostgreSQLをインストール・起動
2. Redisをインストール・起動
3. データベースを作成:
   ```sql
   CREATE DATABASE survey_db;
   ```
4. `database/init.sql`を実行してテーブルを作成

### 2. バックエンドのセットアップ

```bash
cd backend

# 依存関係のインストール
npm install

# 環境変数の設定
cp .env.example .env
# .envファイルを編集して設定を変更

# データベースのシード（サンプルデータ投入）
npm run seed

# 開発サーバー起動
npm run dev
```

バックエンドは `http://localhost:3001` で起動します。

### 3. フロントエンドのセットアップ

```bash
cd frontend

# 依存関係のインストール
npm install

# 環境変数の設定（.env.localを作成）
echo "NEXT_PUBLIC_API_URL=http://localhost:3001" > .env.local
echo "NEXT_PUBLIC_WS_URL=ws://localhost:3001" >> .env.local

# 開発サーバー起動
npm run dev
```

フロントエンドは `http://localhost:3000` で起動します。

## 初期ログイン情報

シードデータ実行後、以下の情報でログインできます：

- **ユーザー名**: `admin`
- **パスワード**: `admin123`

⚠️ **本番環境では必ずパスワードを変更してください**

## 主要な機能

### 投票者向け
- `/vote/{token}` - アンケート投票画面

### 管理画面
- `/admin/login` - ログイン画面
- `/admin/dashboard` - ダッシュボード（アンケート一覧）
- `/admin/surveys/{id}` - アンケート編集画面
- `/admin/analytics` - 分析ダッシュボード

## API エンドポイント

### 公開API
- `GET /api/v1/surveys/token/:token` - アンケート取得
- `POST /api/v1/votes` - 投票送信

### 管理API（認証必須）
- `POST /api/v1/auth/login` - ログイン
- `GET /api/v1/auth/me` - 現在のユーザー情報
- `GET /api/v1/surveys` - アンケート一覧
- `POST /api/v1/surveys` - アンケート作成
- `GET /api/v1/admin/analytics/realtime` - リアルタイム集計データ

詳細は各ルートファイルを参照してください。

## 開発時の注意事項

1. **環境変数**: `.env`ファイルはGitにコミットしないでください
2. **データベース**: 開発時は`docker-compose.yml`のデータベース設定を使用
3. **キャッシュ**: Redisが起動していることを確認してください
4. **CORS**: フロントエンドとバックエンドのURLが正しく設定されているか確認

## トラブルシューティング

### データベース接続エラー
- PostgreSQLが起動しているか確認
- `DATABASE_URL`が正しく設定されているか確認

### Redis接続エラー
- Redisが起動しているか確認
- `REDIS_URL`が正しく設定されているか確認

### 認証エラー
- JWTトークンが正しく設定されているか確認
- トークンの有効期限を確認

## 次のステップ

1. アンケート作成機能の実装
2. ダッシュボード（リアルタイム可視化）の実装
3. 投票データのエクスポート機能
4. テストの追加
5. 本番環境へのデプロイ準備

